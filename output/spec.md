# プロダクト概要

## コンセプト
**EmojiLink（絵文字だけでつながるSNS）** は、言語の壁を超えて誰もが直感的にコミュニケーションできるSNSプラットフォームです。投稿もリアクションも絵文字のみで完結し、シンプルかつ視覚的に楽しめる体験を提供します。

## 主要ペルソナ / 想定利用シーン
- **ペルソナ**: プログラミング未経験の高校生（15〜18歳）
- **シーン**: 
  - 今の気分を手軽に共有したい
  - 言葉で表現するのが難しい感情を絵文字で伝えたい
  - 見て楽しい、触ってすぐ使えるSNSを探している
  - 国際交流イベントで言語を問わずコミュニケーションしたい

## ゴール（何ができたら成功か）
- 高校生が5分以内にアプリを理解し、投稿・リアクションができる
- 絵文字のみという制約を楽しく感じられるUI/UX
- 体験授業（65分）内でローカル環境でのデモ・簡単なカスタマイズが完了する

---

# 機能要件

## タイムライン閲覧
| 項目 | 詳細 |
|------|------|
| 表示形式 | 時系列（新しい投稿が上）のカード形式 |
| 表示内容 | 投稿者アイコン（仮）、投稿絵文字（1〜3個）、リアクション数、投稿日時 |
| 初期表示件数 | 10件（スクロールは手動リロードで追加読み込み想定） |
| 空状態 | 投稿がない場合は「まだ投稿がありません 🎉 最初の投稿をしてみよう！」を表示 |

## 絵文字投稿（文字列は禁止）
| 項目 | 詳細 |
|------|------|
| 投稿可能絵文字数 | 1〜3個（厳密に制限） |
| 入力方法 | 絵文字ピッカーから選択（OSネイティブまたはライブラリ） |
| バリデーション | テキスト・数字・記号が含まれた場合はエラー表示（「絵文字だけで投稿してね！😊」） |
| 投稿ボタン | 「投稿する 🚀」ボタン（絵文字が選択されていない場合は非活性） |
| モーダル表示 | ヘッダーの「＋」ボタンまたはフローティングボタンで投稿モーダルを開く |

## 絵文字リアクション
| 項目 | 詳細 |
|------|------|
| リアクション種類 | 固定5種類：👍 ❤️ 😂 😮 🎉 |
| 操作 | 各投稿のリアクションボタンをタップで追加・再タップで削除 |
| 表示 | 各リアクションの合計数を絵文字と数字で表示（例: 👍 3） |
| 制約 | 1投稿に対して1ユーザーは複数種類のリアクション可能（仮定） |

## 通知・フィードバック（最低限）
| 項目 | 詳細 |
|------|------|
| 投稿成功 | 「投稿しました！✨」トースト表示（2秒で自動消去） |
| リアクション成功 | リアクションボタンのアニメーション（拡大→縮小） |
| エラー通知 | バリデーションエラー時に投稿モーダル内にメッセージ表示 |

## 非機能要件と制約
| 項目 | 詳細 |
|------|------|
| 対象環境 | ローカル開発環境（localhost） |
| 対象ブラウザ | Chrome / Edge / Safari 最新版（モダンブラウザのみ） |
| データ永続化 | ローカルJSON（`src/data/posts.json`）に保存 |
| パフォーマンス | 初回ロード3秒以内、投稿・リアクション操作は即座に反映 |
| アクセシビリティ | キーボード操作不要（マウス/タッチ操作のみで完結） |
| セキュリティ | 認証なし（デモ用のため単一ユーザー想定） |

---

# 画面要件

## 主要画面一覧

### 1. タイムライン画面（メイン）
- **ヘッダー**:
  - アプリタイトル「EmojiLink 🌐」（左揃え）
  - 投稿ボタン「＋」（右上）
  - 簡易プロフィールアイコン（右上、仮固定）
- **タイムライン**:
  - 投稿カード一覧（縦スクロール）
  - 各カード: 投稿者アイコン、投稿絵文字（大きめ表示）、リアクションエリア、投稿日時
- **フッター**: なし（シンプル優先）

### 2. 投稿モーダル
- **構成**:
  - タイトル「絵文字で投稿 ✨」
  - 絵文字ピッカー（OSネイティブまたは `emoji-picker-react` 等）
  - 選択済み絵文字プレビュー（1〜3個表示）
  - 投稿ボタン「投稿する 🚀」
  - キャンセルボタン「✕」（右上）
- **バリデーション**: 絵文字0個または4個以上の場合にエラーメッセージ表示

### 3. プロフィール簡易表示（オプション）
- ヘッダーのアイコンクリックで簡易モーダル表示
- 表示内容: ユーザー名（固定: "Guest User 👤"）、投稿数、参加日（固定）

## 画面遷移・操作フロー
```
[タイムライン画面]
  ↓ 「＋」ボタンクリック
[投稿モーダル表示]
  ↓ 絵文字選択（1〜3個）
  ↓ 「投稿する」ボタンクリック
[タイムラインに新規投稿追加] → トースト表示
  ↓
[タイムライン画面に戻る]

[タイムライン画面]
  ↓ リアクションボタンクリック
[リアクション数即座に更新] → アニメーション再生
```

## コンポーネント構成
| コンポーネント名 | 責務 |
|------------------|------|
| `Header` | タイトル、投稿ボタン、プロフィールアイコン |
| `Timeline` | 投稿カード一覧の表示・管理 |
| `PostCard` | 個別投稿の表示（投稿者、絵文字、リアクション、日時） |
| `ReactionButton` | リアクションボタン（5種類）の表示・操作 |
| `PostModal` | 投稿モーダル（絵文字ピッカー、バリデーション、送信） |
| `EmojiPicker` | 絵文字選択UI（ライブラリラップ） |
| `Toast` | 通知メッセージの表示 |

---

# 技術・データ

## 技術スタック / バージョン
| 技術 | バージョン | 用途 |
|------|------------|------|
| Node.js | 18.x 以上 | 実行環境 |
| React | 18.x | UIフレームワーク |
| Vite | 5.x | ビルドツール（高速起動・HMR） |
| TypeScript | 5.x | 型安全性（オプション、授業の進度次第） |
| emoji-picker-react | 最新 | 絵文字ピッカーUI |
| CSS Modules / Tailwind CSS | - | スタイリング（高校生が真似しやすい方を選択） |

**選定理由**:
- **Vite**: `npm create vite@latest` で即座にセットアップ可能、HMRが高速
- **emoji-picker-react**: シンプルなAPI、カスタマイズ容易

## API（モック）とエンドポイント
**※ 実際のバックエンドAPIは不要。フロントエンドのJSONファイル読み書きで完結。**

| 操作 | 実装方法 |
|------|----------|
| 投稿一覧取得 | `src/data/posts.json` を import して state に格納 |
| 投稿追加 | state を更新後、`localStorage` または JSON ファイルに保存（簡易実装） |
| リアクション追加/削除 | state 内の該当投稿のリアクション配列を更新 |

**注意**: `posts.json` への書き込みはブラウザ環境では直接不可のため、実運用では `localStorage` を使用。デモデータは初期読み込み時に `posts.json` から取得。

## データモデル

### Post（投稿）
```typescript
interface Post {
  id: string;          // ユニークID（UUID or タイムスタンプ）
  emojis: string[];    // 投稿絵文字配列（1〜3個）
  userId: string;      // 投稿者ID（デモでは固定: "user-001"）
  userName: string;    // 投稿者名（デモでは固定: "Guest User"）
  userIcon: string;    // 投稿者アイコン（絵文字: "👤"）
  reactions: Reaction[]; // リアクション配列
  createdAt: string;   // 投稿日時（ISO 8601形式）
}
```

### Reaction（リアクション）
```typescript
interface Reaction {
  emoji: string;       // リアクション絵文字（👍 ❤️ 😂 😮 🎉）
  count: number;       // リアクション数
}
```

### User（ユーザー）※デモでは簡易実装
```typescript
interface User {
  id: string;          // ユーザーID（固定: "user-001"）
  name: string;        // ユーザー名（固定: "Guest User"）
  icon: string;        // アイコン（固定: "👤"）
}
```

## モックデータの例
```json
{
  "posts": [
    {
      "id": "post-001",
      "emojis": ["😊", "🌸"],
      "userId": "user-001",
      "userName": "Guest User",
      "userIcon": "👤",
      "reactions": [
        { "emoji": "👍", "count": 3 },
        { "emoji": "❤️", "count": 1 }
      ],
      "createdAt": "2025-11-21T10:30:00Z"
    },
    {
      "id": "post-002",
      "emojis": ["🎉", "🎊", "🎈"],
      "userId": "user-001",
      "userName": "Guest User",
      "userIcon": "👤",
      "reactions": [
        { "emoji": "🎉", "count": 5 },
        { "emoji": "😂", "count": 2 }
      ],
      "createdAt": "2025-11-21T09:15:00Z"
    },
    {
      "id": "post-003",
      "emojis": ["☕"],
      "userId": "user-001",
      "userName": "Guest User",
      "userIcon": "👤",
      "reactions": [
        { "emoji": "👍", "count": 1 }
      ],
      "createdAt": "2025-11-21T08:00:00Z"
    }
  ]
}
```

---

# 実装・運用上の注意

## バリデーション（絵文字のみ許可）
### 実装方法
```javascript
// 絵文字のみかチェックする正規表現
const isOnlyEmojis = (text) => {
  const emojiRegex = /^[\p{Emoji_Presentation}\p{Emoji}\uFE0F]+$/u;
  return emojiRegex.test(text);
};

// 投稿時のバリデーション
const validatePost = (emojis) => {
  if (emojis.length < 1 || emojis.length > 3) {
    return { valid: false, message: "絵文字を1〜3個選んでね！🎯" };
  }
  for (const emoji of emojis) {
    if (!isOnlyEmojis(emoji)) {
      return { valid: false, message: "絵文字だけで投稿してね！😊" };
    }
  }
  return { valid: true };
};
```

### エラーハンドリング
- バリデーション失敗時: 投稿モーダル内にエラーメッセージを赤字で表示
- ネットワークエラー（将来拡張時）: 「通信エラー 🚫 もう一度試してね」トースト表示

## ログ・エラーハンドリング（簡易）
| 項目 | 実装内容 |
|------|----------|
| コンソールログ | 開発環境では `console.log` で投稿・リアクションのデバッグ情報出力 |
| エラーバウンダリ | React Error Boundary で予期しないエラーをキャッチ→「エラーが発生しました 😢」画面表示 |
| データ保存失敗 | `localStorage` 書き込み失敗時にトースト表示 |

## 体験授業の実行手順（モック起動、ビルド、実行コマンド）

### 事前準備（講師側）
1. プロジェクトテンプレート作成:
   ```bash
   npm create vite@latest emojilink -- --template react
   cd emojilink
   npm install emoji-picker-react
   ```
2. 初期ファイル配置（コンポーネント、モックデータ）
3. GitHub リポジトリにプッシュ、生徒用に配布

### 授業当日（生徒側、65分想定）
**0〜10分: 環境セットアップ**
```bash
# リポジトリクローン
git clone <リポジトリURL>
cd emojilink

# 依存関係インストール
npm install
```

**10〜15分: デモ起動・動作確認**
```bash
# 開発サーバー起動
npm run dev
# ブラウザで http://localhost:5173 を開く
```
- タイムライン表示、投稿、リアクション機能を実際に操作

**15〜50分: カスタマイズ体験**
- タスク例:
  1. 投稿モーダルのタイトルを変更
  2. リアクション絵文字を追加（6種類目を追加）
  3. タイムラインのカード背景色を変更
  4. 自分のユーザー名を変更

**50〜60分: 成果発表**
- 各自のカスタマイズ結果をスクリーンショットで共有

**60〜65分: まとめ・質疑応答**

### コマンド一覧
| コマンド | 用途 |
|----------|------|
| `npm install` | 依存関係インストール |
| `npm run dev` | 開発サーバー起動（HMR有効） |
| `npm run build` | 本番ビルド（デモ後の参考） |
| `npm run preview` | ビルド後のプレビュー |

---

# 仮定・保留

## 仮定事項
1. **ユーザー認証なし**: デモ用のため単一ユーザー（"Guest User"）のみ想定。投稿者は全て同一ユーザーとして扱う。
2. **データ永続化**: `localStorage` を使用。ページリロードでデータは保持されるが、ブラウザのキャッシュクリアで消失する。
3. **リアクション重複**: 1ユーザーが同一投稿に複数種類のリアクションを追加可能とする（制限なし）。
4. **絵文字ピッカー**: `emoji-picker-react` ライブラリを使用。OSネイティブピッカーは環境依存が大きいため採用しない。
5. **投稿数上限**: タイムラインは最新100件まで表示、古い投稿は自動削除（オプション実装）。
6. **国際化不要**: UIテキストはすべて日本語。絵文字は言語非依存のためそのまま使用。
7. **レスポンシブ対応**: PC画面（1280px以上）を主対象とし、スマホ対応は将来の拡張とする。
8. **アニメーション**: リアクションボタンの簡易アニメーション（CSS transition）のみ実装。

## 保留事項（将来拡張）
1. **コメント機能**: 投稿へのコメント（絵文字のみ）を追加する機能
2. **ユーザープロフィール編集**: アイコン・名前のカスタマイズ
3. **投稿削除機能**: 自分の投稿を削除する機能
4. **通知システム**: リアクションされたらブラウザ通知
5. **タイムラインフィルター**: リアクション数順、日付順などのソート機能
6. **多言語対応**: UIテキストの英語版追加
7. **バックエンドAPI**: 実際のデータベース（Firebase/Supabase）連携
8. **マルチユーザー対応**: 複数ユーザーの同時利用・認証機能

---

## 補足: 絵文字バリデーションの技術的詳細
Unicodeの絵文字判定には以下のプロパティを使用:
- `\p{Emoji_Presentation}`: 絵文字として表示される文字
- `\p{Emoji}`: 絵文字関連のすべての文字
- `\uFE0F`: 異体字セレクタ（絵文字スタイル指定）

**注意**: 一部の絵文字（肌色バリエーション、複合絵文字）は複数のコードポイントで構成されるため、文字数カウントに注意が必要。`Array.from()` を使用してコードポイント単位で分割する。

```javascript
const countEmojis = (text) => {
  return Array.from(text).length; // サロゲートペア対応
};
```
